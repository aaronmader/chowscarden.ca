// var menu = JSON.parse('{ "name":"John", "age":30, "city":"New York"}');
var menu = {
	"items": [
		// Combination Platters
			{
				"category": "Combination Platters",
				"name": "CP #1: Honey Garlic Spareribs",
				"description": "Egg Roll<br>Chicken Chow Mein<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #2: Sweet & Sour Pork (Cantonese Style)",
				"description": "Egg Roll<br>Chicken Chow Mein<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #3: Sweet & Sour Chicken Balls",
				"description": "Egg Roll<br>Chicken Chow Mein<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #4: Sweet & Sour Shrimp",
				"description": "Egg Roll<br>Chicken Chow Mein<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #5: Jar Doo Chicken Wings",
				"description": "Egg Roll<br>Chicken Chow Mein<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #6: Sweet & Sour Chicken Balls & Breaded Shrimp",
				"description": "Egg Roll<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #7: Sweet Sour So Guy",
				"description": "Egg Roll<br>Guy Ding<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #8: General Chicken",
				"description": "Egg Roll<br>Vegetables Lo Mein<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #9: Beef Broccoli, and Sesame Chicken",
				"description": "Egg Roll<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "CP #10: Sweet & Sour Chicken Balls",
				"description": "Egg Roll<br>Chicken Lo Mein<br>Chicken Fried Rice<br>Sorry - There will be no substitutions on combination platters",
				"price": "$10.25",
			},
			{
				"category": "Combination Platters",
				"name": "Dinner for Two",
				"description": "Two Egg Rolls (2)<br>Sweet & Sour Chicken Balls<br>Pork Chow Mein<br>Chicken Fried Rice<br>Fortune Cookies<br>Sorry - There will be no substitutions on combination platters",
				"price": "$27.50",
			},
			{
				"category": "Combination Platters",
				"name": "Dinner for Three",
				"description": "Three Egg Rolls (3)<br>Sweet & Sour Pork Cantonese Sauce<br>Mushroom Chow Mein<br>Chicken Fried Rice<br>Guy Ding<br>Fortune Cookies<br>Sorry - There will be no substitutions on combination platters",
				"price": "$36.20",
			},
			{
				"category": "Combination Platters",
				"name": "Dinner for Four",
				"description": "Four Egg Rolls (4)<br>Sweet & Sour Chicken Balls<br>Breaded Shrimp<br>Mushroom Chow Mein<br>Chicken Fried Rice<br>Guy Ding<br>Fortune Cookies<br>Sorry - There will be no substitutions on combination platters",
				"price": "$49.50",
			},
			{
				"category": "Combination Platters",
				"name": "Dinner for Five",
				"description": "Five Egg Rolls (5)<br>Sweet & Sour Chicken Balls<br>Breaded Shrimp<br>Sesame Chicken<br>Sam See Chow Mein<br>Beef with Mixed Vegetables<br>Chicken Fried Rice<br>Fortune Cookies<br>Sorry - There will be no substitutions on combination platters",
				"price": "$64.95",
			},
			{
				"category": "Combination Platters",
				"name": "Dinner for Six",
				"description": "Six Egg Rolls (6)<br>Sweet & Sour Chicken Balls<br>Breaded Shrimp<br>Jar Doo Chicken Wings<br>Chicken Lo Mein<br>Chicken Fried Rice<br>Beef with Broccoli<br>Fortune Cookies<br>Sorry - There will be no substitutions on combination platters",
				"price": "$85.00",
			},

		// Lunch Specials
			{
				"category": "Lunch Specials",
				"name": "Sweet and Sour Chicken Balls with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "Sweet and Sour Pork with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "Jar Doo Chicken Wings with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "Beef, Chicken, or Barbecued Pork Chow Mein with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "Chicken Guy Ding with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "Beef or Chicken Mixed Vegetables with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "Beef or Chicken Broccoli with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "Beef or Chicken Black Bean Sauce with Chicken Fried Rice",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "General Chicken with Chicken Fried Rice",
				"description": "<i class='fas fa-pepper-hot'></i> Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
				"is_spicy": true,
			},
			{
				"category": "Lunch Specials",
				"name": "Curry Chicken or Beef with Chicken Fried Rice",
				"description": "<i class='fas fa-pepper-hot'></i> Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
				"is_spicy": true,
			},
			{
				"category": "Lunch Specials",
				"name": "Szechwan Beef, Chicken, or Pork with Chicken Fried Rice",
				"description": "<i class='fas fa-pepper-hot'></i> Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
				"is_spicy": true,
			},
			{
				"category": "Lunch Specials",
				"name": "Beef, Chicken, or Pork Garlic Sauce with Chicken Fried Rice",
				"description": "<i class='fas fa-pepper-hot'></i> Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
				"is_spicy": true,
			},
			{
				"category": "Lunch Specials",
				"name": "Thai Spicy Chicken or Beef with Chicken Fried Rice",
				"description": "<i class='fas fa-pepper-hot'></i> Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
				"is_spicy": true,
			},
			{
				"category": "Lunch Specials",
				"name": "Pad Thai Beef or Chicken Noodles",
				"description": "<i class='fas fa-pepper-hot'></i> Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
				"is_spicy": true,
			},
			{
				"category": "Lunch Specials",
				"name": "Singapore Fried Rice Noodles",
				"description": "<i class='fas fa-pepper-hot'></i> Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
				"is_spicy": true,
			},
			{
				"category": "Lunch Specials",
				"name": "Shanghai Fried Noodles",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},
			{
				"category": "Lunch Specials",
				"name": "House Specialties Stir Fried Rice Noodles",
				"description": "Served with Egg Roll. 11am - 3pm.",
				"price": "$8.00",
			},

		// Appetizers
			{
				"category": "Appetizers",
				"name": "Egg Roll",
				"price": "$1.70",
			},
			{
				"category": "Appetizers",
				"name": "Homemade Spring Roll",
				"price": "$2.20",
			},
			{
				"category": "Appetizers",
				"name": "Barbecued Pork Slices",
				"price": "$9.60",
			},
			{
				"category": "Appetizers",
				"name": "Jar Doo Chicken Wings",
				"price": "$11.00",
			},
			{
				"category": "Appetizers",
				"name": "Honey Garlic Spareribs",
				"price": "$11.50",
			},
			{
				"category": "Appetizers",
				"name": "Honey Garlic Chicken Wings",
				"price": "$11.15",
			},
			{
				"category": "Appetizers",
				"name": "Barbecued Spareribs (Long)",
				"price": "$11.60",
			},
			{
				"category": "Appetizers",
				"name": "Sweet & Sour Won Ton",
				"price": "$7.90",
			},
			{
				"category": "Appetizers",
				"name": "Cheese Won Ton",
				"price": "$8.90",
			},
			{
				"category": "Appetizers",
				"name": "Deep Fried Dry Spareribs",
				"price": "$11.00",
			},

		// Soups
			{
				"category": "Soups",
				"name": "Consomme Soup",
				"price": "$2.85",
			},
			{
				"category": "Soups",
				"name": "Hot and Sour Soup",
				"description": "<i class='fas fa-pepper-hot'></i>",
				"price": "$4.30",
				"is_spicy": true,
			},
			{
				"category": "Soups",
				"name": "Egg Drop Mushroom Soup",
				"price": "$3.80",
			},
			{
				"category": "Soups",
				"name": "Won Ton Soup - BBQ Pork",
				"price": "$3.80",
			},
			{
				"category": "Soups",
				"name": "Won Ton Soup - Chicken",
				"price": "$3.80",
			},
			{
				"category": "Soups",
				"name": "Won Ton Soup - Noodle",
				"price": "$4.00",
			},
			{
				"category": "Soups",
				"name": "Chicken Noodle Soup",
				"price": "$3.50",
			},
			{
				"category": "Soups",
				"name": "Chicken with Rice Soup",
				"price": "$3.30",
			},

		// Fried Rice
			{
				"category": "Fried Rice",
				"name": "Chow's Garden Fried Rice",
				"price": "$9.90",
			},
			{
				"category": "Fried Rice",
				"name": "Plain Fried Rice",
				"price": "$7.20",
			},
			{
				"category": "Fried Rice",
				"name": "Beef Fried Rice",
				"price": "$8.80",
			},
			{
				"category": "Fried Rice",
				"name": "BBQ Pork Fried Rice",
				"price": "$8.30",
			},
			{
				"category": "Fried Rice",
				"name": "Chicken Fried Rice",
				"price": "$8.30",
			},
			{
				"category": "Fried Rice",
				"name": "Fresh Shrimp Fried Rice",
				"price": "$10.50",
			},
			{
				"category": "Fried Rice",
				"name": "Mushroom Fried Rice",
				"price": "$8.00",
			},
			{
				"category": "Fried Rice",
				"name": "Vegetable Fried Rice",
				"price": "$8.00",
			},
			{
				"category": "Fried Rice",
				"name": "Steamed Rice",
				"price": "$2.50",
			},
			{
				"category": "Fried Rice",
				"name": "Curry Fried Rice",
				"price": "$8.50",
			},

		// Chow Mein
			{
				"category": "Chow Mein",
				"name": "Vegetable Mushroom Chow Mein",
				"price": "$8.00",
			},
			{
				"category": "Chow Mein",
				"name": "Beef Chow Mein",
				"price": "$8.80",
			},
			{
				"category": "Chow Mein",
				"name": "Chicken Chow Mein",
				"price": "$8.30",
			},
			{
				"category": "Chow Mein",
				"name": "BBQ Pork Chow Mein",
				"price": "$8.30",
			},
			{
				"category": "Chow Mein",
				"name": "Fresh Shrimp Chow Mein",
				"price": "$10.80",
			},
			{
				"category": "Chow Mein",
				"name": "Pork Chow Mein",
				"price": "$8.00",
			},

		// Vegetarian Delight
			{
				"category": "Vegetarian Delight",
				"name": "Plain Mixed Vegetables",
				"price": "$9.00",
			},
			{
				"category": "Vegetarian Delight",
				"name": "Garlic Broccoli",
				"price": "$9.00",
			},
			{
				"category": "Vegetarian Delight",
				"name": "Garlic Chinese Green",
				"price": "$9.00",
			},

		// Sweet & Sour (on side)
			{
				"category": "Sweet & Sour (on side)",
				"name": "Sweet & Sour Chicken Balls",
				"price": "$9.90",
			},
			{
				"category": "Sweet & Sour (on side)",
				"name": "Sweet & Sour Shrimps",
				"price": "$11.75",
			},
			{
				"category": "Sweet & Sour (on side)",
				"name": "Sweet & Sour Sue Guy",
				"price": "$10.95",
			},
			{
				"category": "Sweet & Sour (on side)",
				"name": "Sweet & Sour Scallops",
				"price": "$18.45",
			},
			{
				"category": "Sweet & Sour (on side)",
				"name": "Side Order of Sweet & Sour Sauce",
				"price": "$2.45",
			},

		// Egg Foo Young
			{
				"category": "Egg Foo Young",
				"name": "Chow's Garden Egg Foo Young",
				"price": "$11.10",
			},
			{
				"category": "Egg Foo Young",
				"name": "Mushroom Egg Foo Young",
				"price": "$8.75",
			},
			{
				"category": "Egg Foo Young",
				"name": "Chicken Egg Foo Young",
				"price": "$9.80",
			},
			{
				"category": "Egg Foo Young",
				"name": "Plain Egg Foo Young",
				"price": "$8.75",
			},
			{
				"category": "Egg Foo Young",
				"name": "BBQ Pork Egg Foo Young",
				"price": "$9.80",
			},
			{
				"category": "Egg Foo Young",
				"name": "Fresh Shrimp Egg Foo Young",
				"price": "$11.00",
			},


	]
}
// console.log(JSON.stringify(menu))
// console.log(menu)

var options = {
  	valueNames: [ 'category', 'name', 'description', 'price', 'tags' ],
  	// Since there are no elements in the initial list, this will be used as template.
  	item: '<div class="menu_item"><div class="price"></div><div class="category"></div><a href="#" class="heart"><i class="far fa-heart"></i></a><h3 class="name"></h3><div class="description"></div></div>'
};

var userList = new List('menu', options, menu.items);

var category_choice = null;
var spicy_choice = null;
var favourites_choice = null;
var favourites = new Map();

// check localstorage for existing favourites
if (typeof(Storage) !== "undefined") {
	let v = localStorage.getItem("favourites")
	if(v){
		favourites = new Map(JSON.parse(v));

		// update the visuals
		$('.name').each(function(){
			let name = $(this).text()
			if(favourites.has(name)){
				$(this).closest('.menu_item').find('.heart').html('<i class="fas fa-heart"></i>')
			}
		})
	}
}

function my_filterer(item){
	let valid = true
	if (category_choice && item.values().category != category_choice){
		valid = false
	}
	if (spicy_choice && item.values().is_spicy){
		valid = false
	}
	if (favourites_choice && !favourites.has(item.values().name)){
		valid = false
	}
	return valid;
}

document.getElementById('category_filter').onchange = function(){
	category_choice = this.options[this.selectedIndex].value
	userList.filter(my_filterer)
}

document.getElementById('exclude_spicy').onchange = function(){
	spicy_choice = this.checked
	userList.filter(my_filterer)
}

document.getElementById('show_favourites').onchange = function(){
	favourites_choice = this.checked
	userList.filter(my_filterer)
}


$(document).on('click','.heart',function(event){
	event.preventDefault()
	let name = $(this).closest('.menu_item').find('.name').text()
	if(favourites.has(name)){
		// uncheck it
		$(this).html('<i class="far fa-heart"></i>')
		favourites.delete(name)
	}else{
		// check it
		$(this).html('<i class="fas fa-heart"></i>')
		favourites.set(name,'1')
	}

	// save to local storage
	if (typeof(Storage) !== "undefined") {
        // Code for localStorage/sessionStorage.
        let my_json = JSON.stringify(Array.from(favourites.entries()))
        try{
        	localStorage.setItem("favourites", my_json);
        }catch(error){
        	// I don't care, but "developers should make sure to always catch possible exceptions from setItem()."
        	// see: https://developer.mozilla.org/en-US/docs/Web/API/Storage/setItem
        	console.error(error)
        }
    }

})
